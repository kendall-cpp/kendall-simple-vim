

----

## GPIO 基础知识

GPIO（General Purpose Input and Output）是通用输入输出口。其实就是一些引脚，可以通过它们对输出的电平信号或者通过它们读取外部的电平信息，

- 作为输入口
  
一个典型的例子就是控制 LED，电路示意图如下所示。

![](https://img-blog.csdnimg.cn/2e12c65ead8147aabe819c82dea8e95e.png)

图中，使用 GPIO_0 控制了一个 LED，LED 本质上就是一个二极管，当 GPIO 输出**低电平**时，二极管导通，LED 发光；当GPIO 输出**高电平**时，二极管不能导通，LED熄灭。

- 作为输出口

一个典型的例子就是获取按键信息，以判断按键是否按下，电路示意图如下所示。

![](https://img-blog.csdnimg.cn/03dc45e13b7b4528b6ee533e0b23e449.png#pic_center)

图中，使用 GPIO_1 读取按键信息，当按键按下时，GPIO 接地，读取到低电平；反之，按键未按下时，GPIO通过上拉电阻接到 VCC，此时，GPIO 读取到的是高电平。

## 什么是高电平和低电平

输入高电平（VIH）是逻辑门输入为高电平时允许的最小电平。当输入电平高于 VIH，则认为输入电平为高电平。为了保证电路不被损坏，输入电平不能超过电源输出电压（VIO）。

输入低电平（VIL）是逻辑门输入为低电平时允许的最大电平。当输入电平低于 VIL，则认为输入电平为低电平。

## 内部上拉与下拉电阻

在绝大多数MCU中，GPIO 内部都具有可控的上/下拉电阻，此时，就可以省略第一张图中的上拉电阻 R1，当需要上拉电阻时，使能内部上拉电阻即可。

![](https://img-blog.csdnimg.cn/2b06a7fb86404dc6834943bd8667ef29.png#pic_center)

比如上图，上拉是高电平，下拉是低电平。

### GPIO输入

![](https://img-blog.csdnimg.cn/30e4b6f53d634e868c3e010f3c7f5eda.png#pic_center)

开关可控的上下拉电路作用是使输入端对外呈现高阻态。保证在输入引脚悬空时，输入端检测到的电平是稳定的。

输入电路采用施密特触发输入。施密特触发输入的好处是可以解决基本输入电路在跳变沿抖动的问题。施密特触发器上的 on/off 是输入控制开关，作用是可以发出读引脚状态的操作指令。

[参考](https://blog.csdn.net/wyifan_/article/details/124479210)

### GPIO输出

GPIO输出主要有两种，分别是推挽输出和开漏输出。

#### 推挽输出

![](https://img-blog.csdnimg.cn/a46e45483b114fd2ac6c8370122cc7f7.png#pic_center)

如下图所示，推挽输出结构由两个MOS管控制，两个管子不能同时导通。控制器写入高电平，经过反向后，PMOS导通时，NMOS截止，引脚输出高电平；控制器写入低电平，经过反向后，NMOS导通时，PMOS截止，引脚输出低电平。

![](https://img-blog.csdnimg.cn/128d223d3a93446183f51f1c5d448a88.png#pic_center)

> MOS管和三极管组成的单元电路都能使GPIO具有"推挽"和"开漏"的输出特性，因为三极管导通功率较大，所以一般采用MOS管。

#### 开漏输出

![](https://img-blog.csdnimg.cn/5b371c6f6686479e9829b0d6a4d4e188.png#pic_center)

开漏输出分开漏输出和开集输出两种，他们的输出原理和特性基本是类似的，区别在于开漏输出使用MOS管，"漏"指的就是MOS管的漏极；

开集输出使用三极管，"集"指的就是三极管的集电极。由于使用MOS管的情况较多，很多时候就用"开漏输出"这个词代替了开漏输出和开集输出。

开漏输出模式上方的P-MOS管完全不工作。控制器输出低电平，P-MOS管关闭，N-MOS管导通，引脚输出低电平；

控制器输出高电平，P-MOS管和N-MOS管都关闭，引脚既不输出高电平，也不输出低电平，为高阻态。为保证开漏模式正常输出高电平，引脚外部必须接上拉电阻，电路结构如下图所示。

![](https://img-blog.csdnimg.cn/6a1837dbba5047adbc2f87fd51da7acc.png#pic_center)
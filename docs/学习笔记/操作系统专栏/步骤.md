
---


## 完成代码的编写

- 编写代码

```
kendall_os$ tree
.
├── entry.asm
├── hello.lds
├── main.c
├── Makefile
├── vgastr.c
└── vgastr.h
```

- 编译

make

报错 1

```
make: nasm: Command not found
Makefile:43: recipe for target 'entry.o' failed
make: *** [entry.o] Error 127
```

解决：

```
sudo apt-get install nasm
```

再次 make，得到 HelloOS.bin

```
kendall_os/
├── entry.asm
├── entry.o
├── hello.lds
├── HelloOS.bin
├── HelloOS.elf
├── HelloOS.map
├── main.c
├── main.o
├── Makefile
├── vgastr.c
├── vgastr.h
└── vgastr.o
```

经过上述流程，我们就会得到 Hello OS.bin 文件，但是我们还要让 GRUB 能够找到它，才能在计算机启动时加载它。

经过上述流程，我们就会得到 Hello OS.bin 文件，但是我们还要让 GRUB 能够找到它，才能在计算机启动时加载它。

**把 HelloOS.bin 拷贝到 /boot**

在 Linux 系统的终端下输入命令：df /boot/，就会得到如下结果：

```
Filesystem     1K-blocks  Used Available Use% Mounted on
/dev/sda2         945144 66220    813696   8% /boot
```

> 把下面的代码复制，然后插入到 `/boot/grub/grub.cfg` 文件中		 
> 然后把HelloOS.bin文件复制到/boot/目录下		
> 最后重启计算机就可以看到HelloOS启动选项了

```
menuentry 'HelloOS' {
    insmod part_msdos
    insmod ext2
    set root='hd0,msdos2' #注意boot目录挂载的分区，这是我机器上的情况
    multiboot2 /boot/HelloOS.bin   # 这里特别注意，如果你 df /boot/ 命令显示挂载目录[Mounted on]不是 / 而是 /boot 那么路径应该为 /HelloOS.bin
    boot
}
```

### 关于grub.cfg文件只读不能修改问题

这个`grub.cfg`文件是只读属性，`so`如果你要修改它，需要权限。

```bash
sudo chmod +w /boot/grub/grub.cfg
```

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结/kendallOS04.404h7qrog7a0.png)

然后可以编辑`grub.cfg`了。

```bash
sudo vim /boot/grub/grub.cfg
```

PS：**有些远程连接软件在修改`grub.cfg`的时候会出现无法粘贴问题，我使用`MobaXterm`就有这样的问题(其他的不知)。如果出现类似这样无法粘贴或者无法编辑的问题，可以使用`VScode`的终端命令行来编辑。**

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结/kendallOS05.5pttqo0hb900.png)

### 设置开机启动引导菜单

**问题解决**

每次 启动时进入grub引导菜单，需要进行如下设置

- 修改`/etc/default/grub`

```bash
sudo vim /etc/default/grub
```

> *不会使用 vim 的同学自行百度啦 ~~*

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结/kendallOS03.14acwon39g7.png)

- 执行如下命令，更新`grub`配置

```bash
sudo update-grub
```

### update-grub后得重新改grub.cfg

**但是这里又有新的问题啦 ！**

`sudo update-grub`实际就是让系统自己生成合适的`grub.cfg`文件。所以你之前修改的`grub.cfg`文件需要重新修改一次。


------ 


## 使用 DOSBox

打开 DOSBox 软件


- macbook


```
mount c ~/Desktop/WorkDataSplace/myDOSBox
解释一下这个命令，理解了才好记忆：
       => mount：准备、安排的意思；
       => c：表示要虚拟为C盘；
       => d:\dosbox\asm：被虚拟的文件夹路径（存放asm代码的那个）
进入挂载盘：c:
```



- window

```
;hello world 代码

assume cs:code,ds:data

;数据段
data segment
    db 'Hello World!$'
    
data ends

;代码段
assume cs:code,ds:data

;数据段
data segment
    db 11h,22h,10h,'Hello World!$'
    
data ends

;代码段
code segment
    
start:
    ;设置ds的值
    mov ax,data
    mov ds,ax
    
    ;打印字符串
    mov dx,3h   ;从第3个字节开始
    mov ah,9h
    int 21h
    
    ;退出程序
    mov ax, 4c00h
    int 21h

code ends

end start
```


## 寄存器

8086CPU有 14 个寄存器:

- 通用寄存器:AX、BX、CX、DX

- 变址寄存器:SI、DI

- 指针寄存器:SP、BP

- 指令指针寄存器: IP

- 段寄存器:CS、SS、DS、ES

- 标志寄存器:PSW

 
 8086CPU所有的寄存器都是16位的， 可以存放两个字节：

  8086CPU所有的寄存器都是16位的， 可以存放两个字节，存储数据的最大值是：2<sup>16</sup> - 1

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结02/寄存器存储.7781gjswtuw0.png)

> 如果 16 位的寄存器怎么解决 8 位寄存器兼容性的问题？

16 通用寄存器可以分成两个独立的 8 位寄存器，也就是 AX 可以分为「高八位」AH 和「低八位」AL

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结02/寄存器存储01.2alj3la0bgu8.png)


### “字”在寄存器中的存储

> 8086 的字长为 16 位

一个字(word)可以存在一个16位寄存器中

- 这个字的高位字节存在这个寄存器的高8位寄存器
- 这个字的低位字节存在这个寄存器的低8位寄存器

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结02/寄存器存储02.3zsuy04m9ee0.png)

## mov 和 add 指令

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结02/mov和add指令.4bni5bbuyhc0.png)

## 物理地址

8086 有 20 位地址总线，可以传送 20 位地址，寻址能力是 1M

8086 是16位的 CPU，运算器一次最多可以处理 16 位数据，寄存器的最大宽度是 16 位，寻址能力只有 64kb

> 8086 如何解决在寻址空间上的矛盾？

用两个 16 位地址（段地址和偏移地址），合成一个 20 位的物理地址

物理地址 = 段地址 x 16 + 偏移地址  「在地址加法器中完成」

 > x 16 就是向左移 4 位

## 内存的分段

4 个段寄存器


- CS - 代码段寄存器 

- DS - 数据段寄存器 

- SS - 栈段寄存器    

- ES - 附加段寄存器

CS - 代码段寄存器   DS - 数据段寄存器 

SS - 栈段寄存器    ES - 附加段寄存器

  
------

## 第1章

### 存储单元

总线分成三部分；地址总线，数据总线，控制总线

一个 CPU 有 N 根地址线，也就是地址总线的宽度为 N，这样的 CPU 的寻址能力是 2<sup>N</sup>，也就是可以寻找 2 的 N 次方个内存单元。

8086 数据总线有 16 为数据线，那么一次可以传 16 位数据（16 个二进制），同样的数据给 8088 数据总线，有 8 为数据线，那么一次可以传 8 为数据，就需要写两次。

> 一个 CPU 的寻址能力为 8KB ，那么它的地址总线宽度为 13，因为 8kb = 8*1024B = 2<sup>13</sup>


### 寄存器

8086 CPU 所有的寄存器都是 16 为寄存器，可以存储 16 为数据。可以分为两位 8 位寄存器。

> 另外 16 为寄存器只能存 4 为十六进制，8 位寄存器只能存放 2 位十六进制

> ah 和 al 是两个不相关的寄存器，al 不能进位到 ah，除非写成 add ax 93H，这样 CPU 就会认为这条指令只有一个 16 位寄存器

用汇编语言实现 2 的 4 次方

```
mov ax 2
add ax ax
add ax ax
add ax ax
```

### CPU 

8086 CPU 有 20 位地址总线，可以传送 20 位地址，达到 1MB 寻址能力，8086 CPU 又是 16 位结构，内部一次性处理、传输、暂存的地址为 16 位。所以它的寻址能力为 2<sup>16</sup>= 64 KB。所以 CPU 内部需要采用两个 16 位的地址合成一个 20 位的物理地址。这种方式就是：**段基地址x16 + 偏移地址 = 物理地址**。

段地址 x 16 必然是 16 的倍数，偏移地址为 16 位，16 位的寻址能力为 64KB，所以一个段的最大长度为 64KB。

>16 位 段地址 和 16 位偏移地址送入【地址加法器】合成 20 位的物理地址

**指令的执行过程** P30-32

### DOS使用

打开 dosbox

挂载磁盘

```
mount d d:/dos
c:
dir
```

将 masm 文件夹下的文件拷贝到 `d:/dos` 后就可以使用 debug 了

```
debug
q   ;退出
```

### DS 寄存器

【DS寄存器】用来存放访问数据的段地址






















----

## 任务描述

任务输出：`./uboot-repo/build/u-boot.bin`

在 `/mnt/fileroot/shengken.lin/workspace/BuildRoot_A1/bootloader/uboot-repo/bl33/v2019/board/amlogic/defconfigs` 目录下 复制 a5_av400_defconfig 文件，并重新修改。

- 编译步骤

- 拷贝 a5-av400

```sh
uboot-repo/bl33/v2019/arch/arm/dts$ cp meson-a5-av400.dts meson-a5-a113l2-av400.dts   
uboot-repo/bl33/v2019/arch/arm/dts$ cp meson-a5-av400.dtsi meson-a5-a113l2-av400.dtsi
meson-a5-av400.dtsi

uboot-repo/bl33/v2019/board/amlogic/a5_av400$ cp -r * ../a5_a113l2_av400/

uboot-repo/bl33/v2019/board/amlogic/defconfigs$ cp a5_av400_defconfig  a5_a113l2_av400_defconfig
uboot-repo/bl33/v2019/board/amlogic/defconfigs$ chmod +x a5_a113l2_av400_defconfig
# 修改内容如下
需要添加 CONFIG_A5_A113L2_AV400=y  重要
CONFIG_SYS_PROMPT="a113l2_av400# " 命令行显示

uboot-repo/bl33/v2019/board/amlogic/configs$ cp a5_av400.h a113l2_av400.h


```

关于 `uboot-repo/bl33/v2019/board/amlogic/a5_amlogictest$ vim Kconfig` 的修改

> 第一行记得更改

```sh
if TARGET_A5_AMLOGICTEST
   
config SYS_SOC
    default "a5"
   
config SYS_BOARD
    default "a5_a113l2_av400"
   
config SYS_VENDOR
    default "amlogic"
   
config SYS_CONFIG_NAME
    default "a5_a113l2_av400"
   
config DTB_BIND_KERNEL
    bool "load dtb from boot part but not flash rsv"
    default n                                                                                               
 
config CMD_PLLTEST
    bool "support plltest command"
    default n
    help
      support plltest command
   
config AML_REBOOT
       bool "reboot cmd"
       default y
       help
         support uboot reboot cmd
endif


source "board/amlogic/a5_a113l2_av400/Kconfig"  
```


```sh
shengken.lin@walle01-sz:/mnt/fileroot/shengken.lin/workspace/BuildRoot_A1/bootloader/uboot-repo/bl33/v2019/board/amlogic/defconfigs$ chmod +x a5_a113l2_av400_defconfig

需要添加 CONFIG_A5_AMLOGICTEST=y  重要
CONFIG_SYS_PROMPT="amlogictest# " 命令行显示

shengken.lin@walle01-sz:/mnt/fileroot/shengken.lin/workspace/BuildRoot_A1/bootloader/uboot-repo$ ./mk a5_a113l2_av400
```

## av400烧录

需要将 Baud rate 改成 921600

```sh
adnl.exe bl1_boot -f  u-boot.bin.usb.signed
adnl.exe bl2_boot -f  u-boot.bin.usb.signed
adnl.exe partition -m mem -p sheader -f  u-boot.bin.signed
adnl.exe oem "disk_initial 1"

adnl.exe oem "store boot_erase bootloader"
adnl.exe Partition -P bootloader -F  u-boot.bin.signed
```

### 打patch

```sh
# 提交写注释
git commit -a

# 忽略掉代码不规范错误
git commit -a --no-verify
# 查看提交的注释
git commit --amend -s

# 打patch
patch -p1 < 0001-a5-av400-enable-nand.patch 
```

### 提交

- 初次

git commit --amend

```
[Don't merge] Add a5_amlogictest bsp

PD#SWPL-89613

Problem:
U-boot environment preparationn

Solution:
Add a5_amlogictest bsp and finish compiling

Verify:
a5_av400
```

```sh
git config --local user.name "shengken.lin"
git config --local user.email "shengken.lin@amlogic.com"

git branch -a | grep amlogic-4.19-dev
git checkout -t remotes/amlogic/amlogic-4.19-dev  切换分支
git branch
# git add kendall
git status
git commit --amend -s    -s 代表添加当前用户,写注释
git push review HEAD:refs/for/amlogic-dev-2019
```

- 打 patch


```sh
git add arch/arm/dts/meson-a5-all32-amlogictest.dtsi
git add arch/arm/dts/meson-a5-av400.dtsi
git add board/amlogic/a5_amlogictest/a5_amlogictest.c
git add board/amlogic/a5_av400/a5_av400.c
git add cmd/amlogic/cmd_rpmb.c
git add common/Kconfig
git add drivers/mtd/nand/raw/aml_nand/nand_flash.c

git commit -amend -s --no-verify   忽略掉代码不规范错误
```

编写测试

```
[Don't merge] Change a5_amlogictest bsp

PD#SWPL-89613

Problem:
The hardware of the development board is nand unable to burn

Solution:
Change a5_amlogictest to nand

Verify:
a5_av400
```

提交

git add 

git commit --amend -s

git commit --amend -s --no-verify

git push review HEAD:refs/for/amlogic-dev-2019

最终提交：https://scgit.amlogic.com/245893

- 修改名字

```
git add board/amlogic/Kconfig
git add arch/arm/dts/meson-a5-a113l2-av400.dts
git add arch/arm/dts/meson-a5-a113l2-av400.dtsi
git add board/amlogic/a5_a113l2_av400/
git add board/amlogic/configs/a113l2_av400.h
git add board/amlogic/defconfigs/a5_a113l2_av400_defconfi

git push review HEAD:refs/for/amlogic-dev-2019
```

修改信息

```
[Don't merge] Rename a5_amlogictest bsp to a5_a113l2-av400 bsp

PD#SWPL-89613

Problem:
Submission of BSP names is not standard

Solution:
Rename a5_amlogictest  to a5_a113l2-av400

Verify:
a5_av400
```

https://scgit.amlogic.com/245896

## error 记录

```
../board/amlogic/a5_amlogictest/a5_amlogictest.c:179:5: error: function declaration isn’t a prototype [-Werror=strict-prototypes]
 int saradc_get_hw_id()
     ^~~~~~~~~~~~~~~~
```

- 解决：int saradc_get_hw_id() 这是代码规范错误，当没有传参的时候需要添加 void



作业：

```
目前公司海外STB产品主流芯片有哪些？
https://confluence.amlogic.com/display/FCP/0_0_2+2022+Project+Summary+by+Project

Hailstorm版本
https://confluence.amlogic.com/display/SW/Hailstorm+V5.0?preview=%2F142934563%2F184839239%2FAmlogic+Hailstorm+V5.0.0+release+notes+v202205.pdf

STB产品线
https://confluence.amlogic.com/pages/viewpage.action?pageId=148275271&preview=%2F148275271%2F148282832%2F%E5%B8%B8%E5%BB%B6%E8%B1%AA_%E6%B5%B7%E5%A4%96STB%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8DV1.0+20211110_Trianing.pdf
```
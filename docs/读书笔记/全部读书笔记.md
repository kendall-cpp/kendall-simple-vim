

USB开发大全
嵌入式Linux应用开发完全手册

深入理解linux内核  ULK 看完这本书可以直接去看代码了
ARM  Linux内核源码剖析(带书签目录完整版)
linux设备驱动程序 LDD
深入Linux设备驱动程序内核机制
深入理解linux虚拟内存管理  LVMM
linux内核卷1
深入linux内核架构（选读）
内核源代码情景分析



-----

# USB 开发大全

# 深入理解linux内核

## 内存地址

- 逻辑地址

每一个逻辑地址都又一个段 和 偏移量 组成，偏移量指明了从段开始的地方到实际地址之间的距离

- 线性地址

是一个 32 为无符号整数，可以用来表示高 4GB 的地址，通常用 16进制表示。

- 物理地址

用于内存芯片级内存单元寻址，这些地址与从微处理器的地址引脚发送到内存总线上的电信号相对应。物理地址有 32 为或者 36 位无符号整数表示。


**内存控制单元（MMU）** ： 逻辑地址 -->（分段单元）--> 线性地址 --> （分页单元） --> 物理地址

在多处理器系统中，所有的 CPU 都共享同一内存，所以，ARM 由同一 CPU 并发地访问。但是 RAM 芯片的读写操作是串行执行的，所以需要 **内存仲裁器** 来控制 CPU 对 ARM 芯片的访问，当 ARM 芯片空闲时，就允许 CPU 访问，如果 ARM 芯片繁忙时，就延迟 CPU 的访问。

**单处理器系统需要内存仲裁器么？**

同样需要，因为单处理器中有 DMA 控制器，DMA 控制器与 CPU 并发操作

## 硬件中的分段

一个逻辑地址由两部分组成

- 段标识符（段选择符）

一个 16 位长的字段，称为段选择符

- 偏移量

是一个 32 位长的字段

为了方便找到 段选择符 ，处理器提供了段寄存器，用来存放段选择符，段寄存器有： cs，ss，ds，es，fs 和 gs 。

- cs: 代码段寄存器，指向包含程序指令的段

> 还有一个另外的功能，就是指明 CPU 的当前特权等级（CPL），0 代表最高优先级，3 代表最低优先级，linux 只用 0 级和 3 级，**分表表示内核态和用户态**。

- ss：栈段寄存器，指向包含当前程序栈的段
- ds：数据段寄存器，指向包含静态数据或者全局数据段

## 内存管理


在 Linux 中，内存分配的基本单元是“页框”（page frame），其大小通常为 4KB。但是，Linux 支持通过配置来使用不同大小的页框，最大可支持 2MB 大小的页框。

> 为什么呢？

采用 4KB 作为页框大小是出于多方面的考虑。首先，这个大小足够小以满足大多数应用程序的内存管理需求，同时也不会占用过多的内存。其次，较小的页框大小可以提高内存空间的利用率，并减少对磁盘 I/O 的访问次数，从而提高系统性能。此外，4KB 页框大小也便于与硬件平台集成，因为这是目前主流处理器架构的标准大小。在某些场景下，如大规模内存数据库或缓存服务器等应用，可能需要使用更大的页面来提高系统性能，但这通常需要进行额外的配置和调优。

### linux常见物理内存的管理方法有哪些

- Buddy 系统（伙伴系统）：将可用物理内存块分成大小相等的块，并使用二叉树结构来跟踪每个块的可用性和状态。
  - 通常用于分配**大块内存**。它的优势是简单高效，适用于对**内存碎片化要求较低**的场景。
  - 例如数组、图像、视频或者音频文件。这些对象通常需要长期存储，并且在整个程序运行期间都可能被多次访问

- Slab分配器：是一种基于对象缓存的内存分配器，用于分配小块内存。它通过缓存已经分配过的对象来提高性能，并具有更好的内存碎片管理能力。它的优势是可以减少内存碎片化，适合频繁分配和释放**小块内存**的场景。
  - 例如，在编写循环或函数时，可能需要使用小块内存来存储迭代器或局部变量。通常用于存储数据结构、变量、指针等较小的数据对象



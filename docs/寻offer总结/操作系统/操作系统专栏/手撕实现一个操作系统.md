
- [程序编译过程](#程序编译过程)
	- [hello world程序中有什么](#hello-world程序中有什么)
- [PC机的引导流程](#pc机的引导流程)

-------

## 程序编译过程

> 执行 `gcc HelloWorld.c -o HelloWorld` 的过程

其实，GCC 只是完成编译工作的驱动程序，它会根据编译流程分别调用**预处理程序**、**编译程序**、**汇编程序**、**链接程序**来完成具体工作。

下图就是编译这段代码的过程：

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结/gcc编译过程.2h7in83bph60.jpg)

其实，我们也可以手动控制以上这个编译流程，从而留下中间文件方便研究：

- `gcc HelloWorld.c -E -o HelloWorld.i` **预处理**：加入头文件，替换宏。将源文件生成**预处理文件**。
- `gcc HelloWorld.i -s -c HelloWorld.s` **编译**：预处理文件生成**编译文件**。
- `gcc HelloWorld.s -c HelloWorld.o` **汇编**：将编译文件生成**汇编文件**。
- `gcc HelloWorld.o -o HelloWorld` **链接**：汇编文件生成**可执行文件**


根据**冯诺依曼体系结构**构成的计算机，必须具有如下功能：

- 把程序和数据装入到计算机中；
- 必须具有长期记住程序、数据的中间结果及最终运算结果；
- 完成各种算术、逻辑运算和数据传送等数据加工处理；
- 根据需要控制程序走向，并能根据指令控制机器的各部件协调操作；
- 能够按照要求将处理的数据结果显示给用户。

为了完成上述的功能，计算机必须具备五大基本组成部件：

- 装载数据和程序的 **输入设备**；
- 记住程序和数据的 **存储器**；
- 完成数据加工处理的 **运算器**；
- 控制程序执行的 **控制器**；
- 显示处理结果的 **输出设备**。

### hello world程序中有什么

通过执行`gcc -c -s hello.c` 得到汇编程序，然后通过命令 `objdump -d hello.o` 可以查看汇编代码。

```bash
$ objdump -d a.out

0000000000400526 <main>:
  400526:       55                      push   %rbp
  400527:       48 89 e5                mov    %rsp,%rbp
  40052a:       bf c4 05 40 00          mov    $0x4005c4,%edi
  40052f:       e8 cc fe ff ff          callq  400400 <puts@plt>
  400534:       b8 00 00 00 00          mov    $0x0,%eax
  400539:       5d                      pop    %rbp
  40053a:       c3                      retq   
  40053b:       0f 1f 44 00 00          nopl   0x0(%rax,%rax,1) 
```

以上，分成四列：
- 第一列为地址；
- 第二列为十六进制，表示真正装入机器中的代码数据；
- 第三列是对应的汇编代码；
- 第四列是相关代码的注释。

这是 x86_64 体系的代码，由此可以看出 x86 CPU 是变长指令集。

## PC机的引导流程

先借用一下 GRUB 引导程序，只要我们的 PC 机上安装了 Ubuntu Linux 操作系统，GRUB 就已经存在了。

那在写 Hello OS 之前，我们先要搞清楚 Hello OS 的引导流程，如下图所示：

![](https://cdn.jsdelivr.net/gh/kendall-cpp/blogPic@main/寻offer总结/PC机引导过程.2tko93delqo0.jpg)

简单解释一下，PC 机 BIOS 固件是固化在 PC 机主板上的 ROM (只读存储器) 芯片中的，掉电也能保存，PC 机上电后的第一条指令就是 BIOS 固件中的，它**负责检测和初始化 CPU、内存及主板平台**，然后加载引导设备（大概率是硬盘）中的第一个扇区数据，到 `0x7c00` 地址开始的内存空间，再接着跳转到 `0x7c00` 处执行指令，在我们这里的情况下就是 GRUB 引导程序。


## 如何从100亿URL中找出相同的URL

### 题目描述

给定 a、b 两个文件，各存放 50 亿个 URL，每个 URL 各占 64B，内存限制是 4G。请找出 a、b 两个文件共同的 URL。


### 解答思路

每个 URL 占 64B，那么 50 亿个 URL 占用的空间大小约为 320GB。

> 5, 000, 000, 000 * 64B ≈ 5GB * 64 = 320GB

由于内存大小只有 4G，因此，我们不可能一次性把所有 URL 加载到内存中处理。对于这种类型的题目，一般采用**分治策略** ，即：把一个文件中的 URL 按照某个特征划分为多个小文件，使得每个小文件大小不超过 4G，这样就可以把这个小文件读到内存中进行处理了。

### 思路如下

首先遍历文件 a，对遍历到的 URL 求 `hash(URL) % 1000` ，根据计算结果把遍历到的 URL 存储到 a0, a1, a2, ..., a999，这样每个大小约为 `300MB`。使用同样的方法遍历文件 b，把文件 b 中的 URL 分别存储到文件 b0, b1, b2, ..., b999 中。这样处理过后，所有可能相同的 URL 都在对应的小文件中，即 a0 对应 b0, ..., a999 对应 b999，不对应的小文件不可能有相同的 URL。那么接下来，我们只需要求出这 1000 对小文件中相同的 URL 就好了。

接着遍历 $ai( i∈[0,999] )$，把 URL 存储到一个 HashSet 集合中。然后遍历 bi 中每个 URL，看在 HashSet 集合中是否存在，若存在，说明这就是共同的 URL，可以把这个 URL 保存到一个单独的文件中。

### 方法总结

- **分治策略**，进行哈希取余；
- 对每个子文件进行 HashSet 统计。

> [来源：https://mp.weixin.qq.com/s/_JJTaYCf56f_c7xFmNtrSw](https://mp.weixin.qq.com/s/_JJTaYCf56f_c7xFmNtrSw)

## 如何判断一个数是否在40亿个整数中


- 分布式算法

- 排序后查找

首先，32位`int`的范围是42亿，40亿整数中肯定有一些是连续的，我们可以先对数据进行一个外部排序，然后**用一个初始的数和一个长度构成一个数据结构，来表示一段连续的数**，举个例子。

如果数据是`1 2 3 4 6 7……`这种的，那么可以用`(1,4)`和`(6,2)`来表示，这样一来，连续的数都变成了2个数表示。

来了一个新数之后，就用二分法进行查找了。

这样一来，最差情况就是2亿多的断点，也就是2亿多的结构体，每个结构体8个字节，大概16亿字节，`1.6GB`，在内存中可以放下。

> [如何判断一个数是否在40亿个整数中](https://www.iamshuaidi.com/111.html)

